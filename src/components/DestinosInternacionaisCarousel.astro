---
import { getCollection } from 'astro:content';
import SearchDestinos from './SearchDestinos.astro';

const allDestinos = await getCollection('destinos');
const destinosInternacionais = allDestinos
	.filter(destino => destino.data.country !== 'BRASIL' && destino.data.country !== 'Brasil')
	.sort((a, b) => (a.data.order || 0) - (b.data.order || 0));

console.log('Destinos Internacionais:', destinosInternacionais.map(d => ({ title: d.data.title, country: d.data.country })));

function isExternalUrl(url: string) {
	return url.startsWith('http://') || url.startsWith('https://');
}
---

<section class="destinos-internacionais">
	<div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 1rem; text-align: center;">
		<h2>Destinos Internacionais</h2>
		<p>Explore o mundo com a Partiu Viagens. Descubra culturas fascinantes, paisagens deslumbrantes e experi√™ncias inesquec√≠veis em destinos internacionais cuidadosamente selecionados.</p>
		
		<SearchDestinos placeholder="Buscar destino internacional ou data..." />
		
		
		<div class="swiper swiper-internacional" style="cursor: grab;">
			<div class="swiper-wrapper">
				{destinosInternacionais.map((destino) => (
					<div class="swiper-slide">
						<div class="destino-card">
							<a href={`/destinos/${destino.slug}`}>
								<div class="card-image" style="width: 100%; height: auto; aspect-ratio: 1/1; overflow: hidden;">
								<img 
									src={isExternalUrl(destino.data.featuredImage) ? destino.data.featuredImage : `${import.meta.env.BASE_URL}${destino.data.featuredImage}`} 
									alt={destino.data.title} 
									loading="lazy"
									style="width: 100%; height: 100%; object-fit: cover;"
								/>
								</div>
								<div class="card-content">
									{destino.data.isPromo && <div class="promo-badge">PROMO</div>}
									<h3 class="card-title">{destino.data.title}</h3>
									<div class="location">
										<span class="location-icon">üìç</span>
										<span>{destino.data.location}</span>
									</div>
									<div class="description">{destino.data.description}</div>
									<div class="trip-dates">
										<span class="calendar-icon">üìÖ</span>
										<span>{destino.data.tripDates[0]}</span>
									</div>
									<div class="rating">
										<div class="stars">
											{Array.from({ length: 5 }, (_, i) => (
												<span class={i < Math.floor(destino.data.rating) ? 'star filled' : 'star'}>‚òÖ</span>
											))}
										</div>
										<span class="rating-text">{destino.data.rating} ({destino.data.reviewCount} Reviews)</span>
									</div>
									<div class="price">{destino.data.currency} {destino.data.price.toLocaleString('pt-BR')}</div>
								</div>
							</a>
						</div>
					</div>
				))}
			</div>
		</div>
	</div>
</section>

<script>
	import Swiper from 'swiper';
	import { Autoplay } from 'swiper/modules';
	import 'swiper/css';
	

	function initSwiper() {
		const swiperElement = document.querySelector('.swiper-internacional');
		if (swiperElement) {
			const swiper = new Swiper(swiperElement, {
				modules: [Autoplay],
			loop: true,
			grabCursor: true,
				slidesPerView: 1,
				spaceBetween: 32,
				autoplay: {
					delay: 3500,
					disableOnInteraction: false,
				},
				breakpoints: {
					640: {
						slidesPerView: 2,
						spaceBetween: 32,
					},
					768: {
						slidesPerView: 3,
						spaceBetween: 32,
					},
					1024: {
						slidesPerView: 4,
						spaceBetween: 32,
					},
				},
			});
		}
	}

	document.addEventListener('astro:page-load', () => {
		initSwiper();
	});
</script>

<style>
	:root {
		--swiper-theme-color: #0066FF;
		--swiper-navigation-size: 25px;
	}

	.swiper-navigation {
		display: flex;
		justify-content: center;
		align-items: center;
		gap: 2rem;
		margin-top: 2rem;
		width: 100%;
	}

	.swiper-button-next,
	.swiper-button-prev {
		position: static !important;
		background-color: white;
		width: 40px !important;
		height: 40px !important;
		border-radius: 50%;
		box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		margin: 0 !important;
		display: flex;
		justify-content: center;
		align-items: center;
		cursor: pointer;
	}

	.swiper-button-next::after,
	.swiper-button-prev::after {
		font-size: 16px !important;
	}

	.swiper-button-next:hover,
	.swiper-button-prev:hover {
		background-color: #f5f5f5;
	}

	.destinos-internacionais {
		padding: 4rem 0;
		background: linear-gradient(135deg, #e8f4fd 0%, #b3d9f2 100%);
	}

	.container {
		max-width: 1200px;
		margin: 0 auto;
		padding: 0 1rem;
	}

	.destinos-internacionais h2 {
		font-size: 2.5rem;
		font-weight: 700;
		color: #1e293b;
		text-align: center;
		margin-bottom: 1rem;
	}

	.destinos-internacionais p {
		font-size: 1.1rem;
		color: #64748b;
		text-align: center;
		max-width: 600px;
		margin: 0 auto 3rem;
		line-height: 1.6;
	}

	.swiper-internacional {
		position: relative;
		overflow: visible;
		padding: 0 1rem;
		position: relative;
		margin: 2rem 0;
		display: flex;
		justify-content: center;
		width: 100%;
	}

	.swiper-button-next,
	.swiper-button-prev {
		color: #3b82f6;
		top: 50%;
		transform: translateY(-50%);
		width: 2rem;
		height: 2rem;
		background-color: white;
		border-radius: 50%;
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
		transition: all 0.3s ease;
		margin-top: -2rem;
	}

	.swiper-button-next:hover,
	.swiper-button-prev:hover {
		background-color: #3b82f6;
		color: white;
	}

	.swiper-button-next::after,
	.swiper-button-prev::after {
		font-size: 1rem;
	}

	.swiper-slide {
		height: auto;
		width: 320px !important;
		display: flex;
		justify-content: center;
	}

	.destino-card {
		width: 100%;
		max-width: 320px;
		margin: 0 auto;
		background: white;
		border-radius: 16px;
		overflow: hidden;
		box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
		transition: all 0.3s ease;
		height: 100%;
		display: flex;
		flex-direction: column;
	}

	.destino-card:hover {
		transform: translateY(-8px);
		box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
	}

	.destino-card a {
		text-decoration: none;
		color: inherit;
		display: flex;
		flex-direction: column;
		height: 100%;
	}

	.card-image {
		position: relative;
		height: 200px;
		overflow: hidden;
	}

	.card-image img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 0.3s ease;
	}

	.destino-card:hover .card-image img {
		transform: scale(1.05);
	}

	.promo-badge {
		position: absolute;
		top: 12px;
		left: 12px;
		background: linear-gradient(135deg, #3b82f6, #1d4ed8);
		color: white;
		padding: 4px 12px;
		border-radius: 20px;
		font-size: 0.75rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.5px;
	}

	.card-content {
		padding: 1.5rem;
		flex-grow: 1;
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
		justify-content: space-between;
	}

	.rating {
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}

	.stars {
		display: flex;
		gap: 2px;
	}

	.star {
		color: #e2e8f0;
		font-size: 1rem;
	}

	.star.filled {
		color: #fbbf24;
	}

	.rating-text {
		font-size: 0.875rem;
		color: #64748b;
	}

	.card-title {
		font-size: 1.25rem;
		font-weight: 600;
		color: #1e293b;
		line-height: 1.3;
	}

	.location {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		color: #64748b;
		font-size: 0.875rem;
	}

	.location-icon {
		font-size: 1rem;
	}

	.price {
		font-size: 1.5rem;
		font-weight: 700;
		color: #2563eb;
		margin-top: auto;
	}

	/* Responsividade */
	@media (max-width: 768px) {
		.destinos-internacionais {
			padding: 3rem 0;
		}

		.destinos-internacionais h2 {
			font-size: 2rem;
		}

		.destinos-internacionais p {
			font-size: 1rem;
			margin-bottom: 2rem;
		}

		.swiper-internacional {
			padding: 0 0.5rem;
		}

		.swiper-slide {
		width: 320px;
		display: flex;
		justify-content: center;
	}

		.destino-card {
			height: 380px;
		}

		.card-content {
			padding: 1.25rem;
		}

		.card-title {
			font-size: 1.125rem;
		}

		.price {
			font-size: 1.25rem;
		}
	}

	@media (max-width: 480px) {
		.destinos-internacionais h2 {
			font-size: 1.75rem;
		}

		.swiper-slide {
			width: 260px;
		}

		.destino-card {
			height: 360px;
		}

		.card-image {
			height: 180px;
		}

		.card-content {
			padding: 1rem;
		}

		.card-title {
			font-size: 1rem;
			margin-bottom: 0.5rem;
		}

		.rating {
			margin-bottom: 0.5rem;
		}

		.location {
			margin-bottom: 0.75rem;
		}

		.price {
			font-size: 1.125rem;
		}
	}
</style>